.build:apps:
  stage: build
  interruptible: true
  extends:
    - .kaniko_image
  script:
    - /busybox/mkdir -p /root/.docker
    - /busybox/echo $DOCKER_JSON | base64 -d > /root/.docker/config.json
    - /kaniko/executor --context $CI_PROJECT_DIR/apps/go-app --dockerfile $CI_PROJECT_DIR/apps/go-app/Dockerfile --destination friski12/go-helloworld:$TAGGING --single-snapshot=true --snapshot-mode=redo

build:apps:dev:
  extends:
    - .build:apps
  rules:
    - !reference [.next-rules, on-apps-dev]
  variables:
    TAGGING: $CI_COMMIT_SHORT_SHA
  environment:
    name: 'dev'
    action: 'prepare'

